:javascript
  $(document).ready(function(){
    YmContent.Sitemap.init()
    #{"$('#content-package-#{params[:open]}').effect('highlight', 2000);" if @open}
  });
%h2.mb-3.pull-left=title 'Site map & content types'
.clearfix
%ul.nav.nav-tabs.mb-2
  %li{:class => params[:page] ? nil : 'active'}=link_to("Site map", '#site-map', 'data-toggle' => 'tab')
  -if can? :manage, ContentType
    %li=link_to("Content types", '#content-types', 'data-toggle' => 'tab')
  %li{:class => params[:page] ? 'active' : nil}=link_to("Deleted content", '#deleted', 'data-toggle' => 'tab')
.tab-content.tab-content-sitemap
  #site-map.tab-pane{:class => params[:page] ? nil : 'active'}
    %table.table
      %thead
        %tr
          %th.col-md-6 Name
          %th.col-md-2 Status
          %th.col-md-2 Due Date
          %th{:colspan => 4}
            .sitemap-filter.pull-right
              %strong Filter
              &nbsp;
              =select_tag(:status, options_for_select([['All', nil]] + ContentPackage.statuses(current_user).invert.to_a, params[:filter])) 
      %tbody
        -@content_packages.each do |content_package|
          =render('content_package', :content_package => content_package)
        %tr
          %td{:colspan => 7}
            =link_if_can("Add new content", [:new, ContentPackage.new], :icon => 'plus')
  -if can? :manage, ContentType
    #content-types.tab-pane
      %table.table.table-content-types
        %thead
          %tr
            %th.col-md-10{:colspan => 4} Content type / Name
        %tbody
          -@content_types.each do |content_type|
            %tr.content-type
              %td.td-name.col-md-10
                =content_type.to_s.pluralize
                =needs_design(content_type)
              %td
              %td
                =link_to('Edit', edit_content_type_path(content_type))
              %td
                .dropdown
                  =link_to('More&hellip;'.html_safe, '#', 'data-toggle' => 'dropdown')
                  %ul.dropdown-menu
                    %li=link_to("Add new content of this type", new_content_type_content_package_path(content_type))
                    %li=link_to('Reorder content attributes', reorder_content_type_path(content_type))
                    -if content_type.destroyable?
                      %li=link_to('Delete this content type', content_type_path(content_type), :method => :delete, :confirm => "Are you sure you want to delete this content type? This cannot be undone.")
          %tr
            %td{:colspan => 7}
              =link_if_can("Add new content type", [:new, ContentType.new], :icon => 'plus')
    #deleted.tab-pane{:class => params[:page] ? 'active' : nil}
      %table.table
        %thead
          %tr
            %th.col-md-9 Name
            %th{:colspan => 2} Deleted
        %tbody
          -@deleted_content_packages.each do |content_package|
            %tr
              %td=content_package
              %td
                =time_ago_in_words(content_package.deleted_at)
                ago
              %td
                =link_to('Restore', restore_content_package_path(content_package), :method => :put, :confirm => content_package.restore_warning)
      =will_paginate(@deleted_content_packages)

